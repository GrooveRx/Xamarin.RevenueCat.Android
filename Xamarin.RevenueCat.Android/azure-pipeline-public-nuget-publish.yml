trigger:
  branches:
    include:
      - refs/tags/release-v*

pool:
  vmImage: 'macOS-10.15'

variables:
  - group: nuget.org

steps:
- bash: |
    echo "##vso[build.updatebuildnumber]xamarin-revenuecat-android-$(Build.SourceBranchName)-$(Build.BuildId)"

- bash: |
    cd Xamarin.RevenueCat.Android
    msbuild /p:Configuration=Release

- task: NuGetAuthenticate@0
  inputs:
    nuGetServiceConnections: 'nuget.org thisisthekap connection'

- bash: |
    dotnet nuget push foo.nupkg -k $(nugetOrgApiKey) -s https://api.nuget.org/v3/index.json

- task: GitHubRelease@1
  inputs:
    gitHubConnection: 'github.com_thisisthekap'
    repositoryName: 'thisisthekap/Xamarin.RevenueCat.Android'
    action: 'create'
    target: '$(Build.SourceVersion)'
    tagSource: 'userSpecifiedTag'
    tag: '$(Build.SourceBranchName)'
    title: 'Xamarin.RevenueCat.Android $(bindingsVersion)'
    assets: 'Xamarin.RevenueCat.Android/nugetoutput/*.nupkg'
    changeLogCompareToRelease: 'lastFullRelease'
    changeLogType: 'issueBased'
