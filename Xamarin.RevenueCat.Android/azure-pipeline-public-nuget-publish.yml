trigger:
  branches:
    include:
      - refs/tags/release-v*

pool:
  vmImage: 'macOS-10.15'

steps:
- bash: |
    echo "##vso[build.updatebuildnumber]xamarin-revenuecat-android-$(Build.SourceBranchName)-$(Build.BuildId)"

- bash: |
    cd Xamarin.RevenueCat.Android
    msbuild /p:Configuration=Release

- task: NuGetAuthenticate@0
  inputs:
    nuGetServiceConnections: 'nuget.org thisisthekap connection'

- task: NuGetCommand@2
  inputs:
    command: 'push'
    packagesToPush: 'Xamarin.RevenueCat.Android/nugetoutput/*.nupkg;!Xamarin.RevenueCat.Android/nugetoutput/*.symbols.nupkg'
    nuGetFeedType: 'external'
    publishFeedCredentials: 'nuget.org thisisthekap connection'

- task: GitHubRelease@1
  inputs:
    gitHubConnection: 'github.com_thisisthekap'
    repositoryName: 'thisisthekap/Xamarin.RevenueCat.Android'
    action: 'create'
    target: '$(Build.SourceVersion)'
    tagSource: 'userSpecifiedTag'
    tag: '$(Build.SourceBranchName)'
    title: 'Xamarin.RevenueCat.Android $(bindingsVersion)'
    assets: 'Xamarin.RevenueCat.Android/nugetoutput/*.nupkg'
    changeLogCompareToRelease: 'lastFullRelease'
    changeLogType: 'issueBased'
